cmake_minimum_required(VERSION 3.0)
project(human-viz-bridge)

include(YarpInstallationHelpers)
include(YarpIDL)
include(GNUInstallDirs)

yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/thrift/XsensFrame.thrift" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/data" THRIFT_SOURCES THRIFT_HEADERS THRIFT_INCLUDE_DIRS)
yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/thrift/XsensDriverService.thrift" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/services" THRIFT_SERVICE_SOURCES THRIFT_SERVICE_HEADERS THRIFT_SERVICE_INCLUDE_DIRS)
##yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/thrift/HumanState.thrift" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/data" HTHRIFT_SOURCES HTHRIFT_HEADERS HTHRIFT_INCLUDE_DIRS)

add_library(human-viz-bridge-thrift STATIC ${THRIFT_SOURCES} ${THRIFT_HEADERS} 
                                           ##${HTHRIFT_SOURCES} ${HTHRIFT_HEADERS}
                                           ${THRIFT_SERVICE_SOURCES} ${THRIFT_SERVICE_HEADERS})
target_link_libraries(human-viz-bridge-thrift ${YARP_LIBRARIES})
target_include_directories(human-viz-bridge-thrift PUBLIC ${THRIFT_INCLUDE_DIRS}
                                                          ##${HTHRIFT_INCLUDE_DIRS}
                                                          ${THRIFT_SERVICE_INCLUDE_DIRS})
target_include_directories(human-viz-bridge-thrift SYSTEM PUBLIC ${YARP_INCLUDE_DIRS})

yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/msgs/String.msg" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/msgs" STRING_SOURCES STRING_HEADERS STRING_INCLUDE_DIRS)
yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/msgs/std_msgs/Header.msg" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/msgs" HEADER_SOURCES HEADER_HEADERS HEADER_INCLUDE_DIRS)
yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/msgs/geometry_msgs/Quaternion.msg" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/msgs" QUATERNION_SOURCES QUATERNION_HEADERS QUATERNION_INCLUDE_DIRS)
yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/msgs/geometry_msgs/Transform.msg" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/msgs" TRANSFORM_SOURCES TRANSFORM_HEADERS TRANSFORM_INCLUDE_DIRS)
yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/msgs/geometry_msgs/TransformStamped.msg" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/msgs" TRANSFORMSTAMPED_SOURCES TRANSFORMSTAMPED_HEADERS TRANSFORMSTAMPED_INCLUDE_DIRS)
yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/msgs/geometry_msgs/Vector3.msg" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/msgs" VECTOR_SOURCES VECTOR_HEADERS VECTOR_INCLUDE_DIRS)
yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/msgs/geometry_msgs/Wrench.msg" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/msgs" WRENCH_SOURCES WRENCH_HEADERS WRENCH_INCLUDE_DIRS)
yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/msgs/geometry_msgs/WrenchStamped.msg" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/msgs" WRENCHSTAMPED_SOURCES WRENCHSTAMPED_HEADERS WRENCHSTAMPED_INCLUDE_DIRS)
yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/msgs/tf2_msgs/TFMessage.msg" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/msgs" TFMESSAGE_SOURCES TFMESSAGE_HEADERS TFMESSAGE_INCLUDE_DIRS)
yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/msgs/sensor_msgs/JointState.msg" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/msgs" JOINTSTATE_SOURCES JOINTSTATE_HEADERS JOINTSTATE_INCLUDE_DIRS)
yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/msgs/tf/tfMessage.msg" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/msgs" TFTFMESSAGE_SOURCES TFTFMESSAGE_HEADERS TFTFMESSAGE_INCLUDE_DIRS)

add_library(human-viz-bridge-rosmsgs INTERFACE)
target_include_directories(human-viz-bridge-rosmsgs INTERFACE ${STRING_INCLUDE_DIRS} 
                                                              ${TFMESSAGE_INCLUDE_DIRS} 
                                                              ${HEADER_INCLUDE_DIRS} 
                                                              ${QUATERNION_INCLUDE_DIRS} 
                                                              ${TRANSFORM_INCLUDE_DIRS} 
                                                              ${TRANSFORMSTAMPED_INCLUDE_DIRS} 
                                                              ${VECTOR_INCLUDE_DIRS} ${WRENCH_INCLUDE_DIRS} 
                                                              ${WRENCHSTAMPED_INCLUDE_DIRS} 
                                                              ${JOINTSTATE__INCLUDE_DIRS} 
                                                              ${TFTFMESSAGE__INCLUDE_DIRS})

# TF bridge

add_executable(human-tf-bridge src/HumanTFBridge.cpp)

target_link_libraries(human-tf-bridge YARP::YARP_OS 
                                      YARP::YARP_dev
                                      iDynTree::idyntree-model
                                      iDynTree::idyntree-modelio-urdf
                                      human-viz-bridge-thrift
                                      human-viz-bridge-rosmsgs)

target_include_directories(human-tf-bridge PUBLIC ${YARP_INCLUDE_DIRS})

                                                
list(APPEND conf config/human-tf-bridge.ini)

# Joints bridge                                                
                                                
add_executable(human-jointstate-bridge src/HumanJointStateBridge.cpp)

target_link_libraries(human-jointstate-bridge YARP::YARP_OS 
                                              YARP::YARP_dev
                                              iDynTree::idyntree-model
                                              iDynTree::idyntree-modelio-urdf
                                              human-viz-bridge-thrift
                                              human-viz-bridge-rosmsgs
                                              human-state-provider-data
                                              )

target_include_directories(human-jointstate-bridge PUBLIC ${YARP_INCLUDE_DIRS})

list(APPEND conf config/human-jointstate-bridge.ini)

yarp_install(FILES ${conf} DESTINATION ${YARP_CONTEXTS_INSTALL_DIR}/human-dynamic-estimation)

install(TARGETS human-tf-bridge human-jointstate-bridge 
        RUNTIME DESTINATION ${CMAKE_INSTALL_FULL_BINDIR}
        ARCHIVE DESTINATION ${CMAKE_INSTALL_FULL_LIBDIR}
        LIBRARY DESTINATION ${CMAKE_INSTALL_FULL_LIBDIR})

#### add the "uninstall" target
include(AddUninstallTarget)
