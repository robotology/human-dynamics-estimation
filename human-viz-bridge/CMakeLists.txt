cmake_minimum_required(VERSION 3.0)
project(human-viz-bridge)

set (CMAKE_CXX_STANDARD 11)

yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/thrift/XsensFrame.thrift" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/data" THRIFT_SOURCES THRIFT_HEADERS THRIFT_INCLUDE_DIRS)
yarp_idl_to_dir("${CMAKE_CURRENT_SOURCE_DIR}/thrift/XsensDriverService.thrift" "${CMAKE_CURRENT_BINARY_DIR}/autogenerated/services" THRIFT_SERVICE_SOURCES THRIFT_SERVICE_HEADERS THRIFT_SERVICE_INCLUDE_DIRS)

add_library(human-viz-bridge-thrift STATIC ${THRIFT_SOURCES} ${THRIFT_HEADERS} 
                                           ${THRIFT_SERVICE_SOURCES} ${THRIFT_SERVICE_HEADERS})
target_link_libraries(human-viz-bridge-thrift ${YARP_LIBRARIES})
target_include_directories(human-viz-bridge-thrift PUBLIC ${THRIFT_INCLUDE_DIRS}
                                                          ${THRIFT_SERVICE_INCLUDE_DIRS})
target_include_directories(human-viz-bridge-thrift SYSTEM PUBLIC ${YARP_INCLUDE_DIRS})

# TF bridge
add_executable(human-tf-bridge src/HumanTFBridge.cpp)

add_warnings_configuration_to_target(TARGETS human-tf-bridge PRIVATE)

target_link_libraries(human-tf-bridge YARP::YARP_OS 
                                      YARP::YARP_dev
                                      iDynTree::idyntree-model
                                      iDynTree::idyntree-modelio-urdf
                                      human-viz-bridge-thrift
                                      human-rosmsgs)

target_include_directories(human-tf-bridge PUBLIC ${YARP_INCLUDE_DIRS})

                                                
list(APPEND conf config/human-tf-bridge.ini)

# Joints bridge                                                
                                                
add_executable(human-jointstate-bridge src/HumanJointStateBridge.cpp)

add_warnings_configuration_to_target(TARGETS human-jointstate-bridge PRIVATE)

target_link_libraries(human-jointstate-bridge YARP::YARP_OS 
                                              YARP::YARP_dev
                                              iDynTree::idyntree-core
                                              iDynTree::idyntree-model
                                              iDynTree::idyntree-modelio-urdf
                                              human-viz-bridge-thrift
                                              human-rosmsgs
                                              human-state-provider-data)

target_include_directories(human-jointstate-bridge PUBLIC ${YARP_INCLUDE_DIRS})

list(APPEND conf config/human-jointstate-bridge.ini)

# Human Effort bridge

add_executable(human-effort-bridge src/HumanEffortBridge.cpp)

target_link_libraries(human-effort-bridge YARP::YARP_OS 
                                          YARP::YARP_dev
                                          iDynTree::idyntree-model
                                          iDynTree::idyntree-modelio-urdf
                                          human-viz-bridge-thrift
                                          human-rosmsgs
                                          human-state-provider-data
                                          human-dynamics-estimator-data)

target_include_directories(human-effort-bridge PUBLIC ${YARP_INCLUDE_DIRS})
                                              
list(APPEND conf config/human-effort-bridge.ini)


# Robot Base pose provider

add_executable(robot-basepose-publisher src/RobotBasePosePublisher.cpp)

target_link_libraries(robot-basepose-publisher  YARP::YARP_OS 
                                               YARP::YARP_dev
                                               iDynTree::idyntree-high-level
                                               iDynTree::idyntree-model
                                               iDynTree::idyntree-modelio-urdf
                                               human-viz-bridge-thrift
                                               human-rosmsgs
                                               human-state-provider-data
                                               human-dynamics-estimator-data)

target_include_directories(robot-basepose-publisher PUBLIC ${YARP_INCLUDE_DIRS} ${EIGEN3_INCLUDE_DIR})
                                              
list(APPEND conf config/robot-basepose-publisher.ini)

# iCub Effort Bridge

add_executable(icub-effort-bridge src/iCubEffortBridge.cpp)

target_link_libraries(icub-effort-bridge YARP::YARP_OS 
                                               YARP::YARP_dev
                                               iDynTree::idyntree-high-level
                                               iDynTree::idyntree-model
                                               iDynTree::idyntree-modelio-urdf
                                               human-viz-bridge-thrift
                                               human-rosmsgs
                                               human-state-provider-data
                                               human-dynamics-estimator-data)

target_include_directories(icub-effort-bridge PUBLIC ${YARP_INCLUDE_DIRS} ${EIGEN3_INCLUDE_DIR})
                                              
list(APPEND conf config/icub-effort-bridge.ini)

yarp_install(FILES ${conf} DESTINATION ${YARP_CONTEXTS_INSTALL_DIR}/human-dynamic-estimation)

install(TARGETS human-tf-bridge 
                human-jointstate-bridge
                human-effort-bridge
                robot-basepose-publisher
                icub-effort-bridge
        RUNTIME DESTINATION ${CMAKE_INSTALL_FULL_BINDIR}
        ARCHIVE DESTINATION ${CMAKE_INSTALL_FULL_LIBDIR}
        LIBRARY DESTINATION ${CMAKE_INSTALL_FULL_LIBDIR})

